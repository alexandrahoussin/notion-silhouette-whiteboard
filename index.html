<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Whiteboard Couture</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{margin:0;display:flex;flex-direction:column;height:100vh;font-family:sans-serif}
    header,footer{display:flex;justify-content:center;align-items:center;gap:10px;padding:8px;background:#fafafa;box-shadow:0 1px 4px rgba(0,0,0,0.1);flex-wrap:wrap}
    .canvas-container{flex:1;display:flex;justify-content:center;align-items:center;position:relative;overflow:hidden}
    canvas{border:1px solid #ccc;background:#fff;touch-action:none}
    button{padding:6px 10px;border-radius:6px;border:none;background:#e0ebdb;cursor:pointer}
    button:hover{background:#fe6fa8;color:#fff}
    .dropdown{position:relative}
    .dropdown-content{display:none;position:absolute;background:#fff;min-width:180px;box-shadow:0 2px 6px rgba(0,0,0,0.2);z-index:100;top:100%;left:0}
    .dropdown.show .dropdown-content{display:block}
    .dropdown-content button,.dropdown-content label{background:#fff;color:#333;width:100%;text-align:left;padding:8px;border:none}
    .dropdown-content button:hover{background:#eee}
    #placeholder{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#888;font-size:16px;text-align:center;pointer-events:none}
    #patternPreview{width:28px;height:28px;border:1px solid #aaa;border-radius:4px;background-size:cover;background-position:center;cursor:pointer}
    .active-option{border:2px solid #fe6fa8}
  </style>
</head>
<body>
<header>
  <div class="dropdown">
    <button onclick="toggleDropdown(this)">Silhouette ‚ñº</button>
    <div class="dropdown-content">
      <button onclick="setSilhouette('silhouette/woman.png');closeDropdowns()">Femme</button>
      <button onclick="setSilhouette('silhouette/man.png');closeDropdowns()">Homme</button>
      <button onclick="setSilhouette('silhouette/child.png');closeDropdowns()">Enfant</button>
      <button onclick="setSilhouette('silhouette/baby.png');closeDropdowns()">B√©b√©</button>
      <label><input type="file" onchange="uploadSilhouette(event)" hidden>Ajouter une image</label>
      <button onclick="removeSilhouette();closeDropdowns()">Supprimer silhouette</button>
    </div>
  </div>

  <div class="dropdown">
    <button onclick="toggleDropdown(this)">Dessin ‚ñº</button>
    <div class="dropdown-content">
      <label>Couleur <input type="color" id="color" value="#000000" onchange="setColor(this.value)"></label>
      <label>Largeur <input type="range" min="1" max="20" value="2" onchange="setSize(this.value)"></label>
    </div>
  </div>

  <div class="dropdown">
    <button onclick="toggleDropdown(this)">Remplissage ‚ñº</button>
    <div class="dropdown-content">
      <button id="colorModeBtn" onclick="setFillModeColor()">Couleur</button>
      <input type="color" id="fillColor" value="#ff0000" onchange="setFillColor(this.value)">
      <button id="patternModeBtn" onclick="setFillModePattern()">Motif</button>
      <div id="patternPreview" onclick="document.getElementById('patternInput').click()"></div>
      <input type="file" id="patternInput" accept="image/*" hidden onchange="loadFillPattern(event)">
    </div>
  </div>

  <button id="draw-btn" onclick="setDrawMode()">‚úèÔ∏è Mode dessin</button>
  <button id="fill-btn" onclick="setFillMode()">ü™£ Mode remplissage</button>
</header>

<div class="canvas-container">
  <canvas id="board"></canvas>
  <div id="placeholder">‚úèÔ∏è Ici je laisse place √† mon imagination,<br> je peux dessiner ou choisir une silhouette.</div>
</div>

<footer>
  <button onclick="undo()">‚Ü©Ô∏è Annuler</button>
  <button onclick="redo()">‚Ü™Ô∏è R√©tablir</button>
  <button onclick="clearDrawing()">üóëÔ∏è Effacer</button>
  <button onclick="zoomIn()">üîç+</button>
  <button onclick="zoomOut()">üîç-</button>
</footer>

<script>
const canvas=document.getElementById("board"),ctx=canvas.getContext("2d");
const buffer=document.createElement("canvas"),bctx=buffer.getContext("2d");
let drawing=false,fillMode=false,usePattern=false,fillPattern=null;
let currentColor="#000",currentSize=2,fillColor="#ff0000";
let undoStack=[],redoStack=[],hasDrawn=false;
let scale=1,offsetX=0,offsetY=0,pan=false,startPanX=0,startPanY=0;
let silhouette=null;

function resize(){canvas.width=window.innerWidth*0.8;canvas.height=window.innerHeight*0.6;
 buffer.width=canvas.width;buffer.height=canvas.height;redraw();}
window.onresize=resize;resize();

function screenToBuffer(x,y){return{x:(x-offsetX)/scale,y:(y-offsetY)/scale};}
function redraw(){ctx.setTransform(1,0,0,1,0,0);ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.setTransform(scale,0,0,scale,offsetX,offsetY);
 if(silhouette){const r=Math.min(buffer.width/silhouette.width,buffer.height/silhouette.height)*0.9;
  const w=silhouette.width*r,h=silhouette.height*r;
  ctx.drawImage(silhouette,(buffer.width-w)/2,(buffer.height-h)/2,w,h);}
 ctx.drawImage(buffer,0,0);
 document.getElementById("placeholder").style.display=(hasDrawn||silhouette)?"none":"block";}

function startDraw(x,y){if(fillMode){const b=screenToBuffer(x,y);floodFill(Math.floor(b.x),Math.floor(b.y));pushState();return;}
 drawing=true;const b=screenToBuffer(x,y);bctx.beginPath();bctx.moveTo(b.x,b.y);}
function moveDraw(x,y){if(pan){offsetX+=x-startPanX;offsetY+=y-startPanY;startPanX=x;startPanY=y;redraw();return;}
 if(!drawing)return;const b=screenToBuffer(x,y);bctx.lineWidth=currentSize;bctx.lineCap="round";bctx.strokeStyle=currentColor;
 bctx.lineTo(b.x,b.y);bctx.stroke();hasDrawn=true;redraw();}
function endDraw(){if(drawing)pushState();drawing=false;pan=false;}

canvas.addEventListener("mousedown",e=>{const r=canvas.getBoundingClientRect();startPanX=e.clientX-r.left;startPanY=e.clientY-r.top;
 if(e.button===1){pan=true;return;}startDraw(startPanX,startPanY);});
canvas.addEventListener("mousemove",e=>{const r=canvas.getBoundingClientRect();moveDraw(e.clientX-r.left,e.clientY-r.top);});
canvas.addEventListener("mouseup",endDraw);
canvas.addEventListener("mouseleave",endDraw);

canvas.addEventListener("touchstart",e=>{
 if(e.touches.length===1){const r=canvas.getBoundingClientRect();startDraw(e.touches[0].clientX-r.left,e.touches[0].clientY-r.top);}
 if(e.touches.length===2){pan=true;startPanX=(e.touches[0].clientX+e.touches[1].clientX)/2;startPanY=(e.touches[0].clientY+e.touches[1].clientY)/2;}
});
canvas.addEventListener("touchmove",e=>{
 const r=canvas.getBoundingClientRect();
 if(e.touches.length===1){moveDraw(e.touches[0].clientX-r.left,e.touches[0].clientY-r.top);}
 if(e.touches.length===2){const cx=(e.touches[0].clientX+e.touches[1].clientX)/2,cy=(e.touches[0].clientY+e.touches[1].clientY)/2;
 offsetX+=cx-startPanX;offsetY+=cy-startPanY;startPanX=cx;startPanY=cy;redraw();}
});
canvas.addEventListener("touchend",endDraw);

function pushState(){undoStack.push(buffer.toDataURL());redoStack=[];}
function undo(){if(!undoStack.length)return;redoStack.push(buffer.toDataURL());const img=new Image();img.onload=()=>{bctx.clearRect(0,0,buffer.width,buffer.height);bctx.drawImage(img,0,0);redraw();};img.src=undoStack.pop();}
function redo(){if(!redoStack.length)return;undoStack.push(buffer.toDataURL());const img=new Image();img.onload=()=>{bctx.clearRect(0,0,buffer.width,buffer.height);bctx.drawImage(img,0,0);redraw();};img.src=redoStack.pop();}
function clearDrawing(){bctx.clearRect(0,0,buffer.width,buffer.height);redraw();}

function zoomIn(){scale*=1.2;redraw();}
function zoomOut(){scale/=1.2;redraw();}

function floodFill(x,y){const img=bctx.getImageData(0,0,buffer.width,buffer.height);const data=img.data;
 const si=(y*buffer.width+x)*4;const sr=data[si],sg=data[si+1],sb=data[si+2],sa=data[si+3];const stack=[[x,y]],vis=new Uint8Array(buffer.width*buffer.height);
 while(stack.length){const[cx,cy]=stack.pop();if(cx<0||cy<0||cx>=buffer.width||cy>=buffer.height)continue;const i=(cy*buffer.width+cx)*4;
  if(vis[cy*buffer.width+cx])continue;if(data[i]!==sr||data[i+1]!==sg||data[i+2]!==sb||data[i+3]!==sa)continue;vis[cy*buffer.width+cx]=1;
  if(usePattern&&fillPattern){const px=cx%fillPattern.width,py=cy%fillPattern.height;const pd=fillPattern.getContext("2d").getImageData(px,py,1,1).data;
   data[i]=pd[0];data[i+1]=pd[1];data[i+2]=pd[2];data[i+3]=pd[3];}
  else{const rgb=hexToRgb(fillColor);data[i]=rgb.r;data[i+1]=rgb.g;data[i+2]=rgb.b;data[i+3]=255;}
  stack.push([cx+1,cy],[cx-1,cy],[cx,cy+1],[cx,cy-1]);}
 bctx.putImageData(img,0,0);hasDrawn=true;redraw();}

function setSilhouette(src){silhouette=new Image();silhouette.onload=redraw;silhouette.src=src;}
function removeSilhouette(){silhouette=null;redraw();}
function uploadSilhouette(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>setSilhouette(ev.target.result);r.readAsDataURL(f);}
function loadFillPattern(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{const img=new Image();img.onload=()=>{const pc=document.createElement("canvas");pc.width=50;pc.height=50;pc.getContext("2d").drawImage(img,0,0,50,50);fillPattern=pc;document.getElementById("patternPreview").style.backgroundImage=`url(${ev.target.result})`;};img.src=ev.target.result;};r.readAsDataURL(f);}

function hexToRgb(h){const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(h);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:{r:0,g:0,b:0};}

function toggleDropdown(b){const dd=b.parentElement;document.querySelectorAll(".dropdown").forEach(d=>d.classList.remove("show"));dd.classList.toggle("show");}
function closeDropdowns(){document.querySelectorAll(".dropdown").forEach(d=>d.classList.remove("show"));}
function setColor(v){currentColor=v;}
function setSize(v){currentSize=+v;}
function setFillColor(v){fillColor=v;}
function setDrawMode(){fillMode=false;}
function setFillMode(){fillMode=true;}
function setFillModeColor(){usePattern=false;document.getElementById("colorModeBtn").classList.add("active-option");document.getElementById("patternModeBtn").classList.remove("active-option");}
function setFillModePattern(){usePattern=true;document.getElementById("patternModeBtn").classList.add("active-option");document.getElementById("colorModeBtn").classList.remove("active-option");}

pushState();redraw();
</script>
</body>
</html>
