<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Whiteboard Couture — corrigé</title>
<style>
  :root {
    --btn: #E0EBDB;
    --btn-hover: #FE6FA8;
    --panel: #ffffff;
    --text: #333;
    --dropdown-w: 280px;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:#fafafa;color:var(--text);}
  .app{display:flex;flex-direction:column;height:100vh;gap:8px;padding:8px;box-sizing:border-box;}

  header, footer{
    display:flex;align-items:center;justify-content:center;gap:10px;
    background:var(--panel);padding:10px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.06);
    flex-wrap:wrap;
  }

  .btn, label.btn {
    background:var(--btn); border:0; padding:8px 12px; border-radius:8px;
    min-width:120px; height:40px; display:inline-flex; align-items:center; justify-content:center;
    gap:8px; cursor:pointer; font-size:14px; color:#444;
  }
  .btn img, label.btn img{ width:18px; height:18px; }
  .btn:hover, label.btn:hover{ background:var(--btn-hover); color:white; }

  .dropdown{ position:relative; display:inline-block; }
  .dropdown > .btn { user-select:none; }
  .dropdown-content{
    display:none; position:absolute; top:calc(100% + 8px); left:0; z-index:3000;
    width:var(--dropdown-w); background:white; border:1px solid #e6e6e6; border-radius:8px;
    box-shadow:0 12px 28px rgba(0,0,0,0.08); overflow:hidden;
  }
  .dropdown.show > .dropdown-content{ display:block; }

  .dropdown-content .item{
    display:flex; align-items:center; justify-content:flex-start; gap:10px;
    width:100%; padding:10px 14px; background:white; color:#333; border:0; cursor:pointer; font-size:14px;
  }
  .dropdown-content .item:hover{ background:#f6f6f6; color:#000; }

  .tool-item{ display:flex; align-items:center; justify-content:flex-start; gap:12px; padding:8px 12px; }
  .tool-item label{ min-width:70px; color:#333; font-size:13px; }

  .canvas-wrap{ flex:1; display:flex; align-items:center; justify-content:center; position:relative; }
  canvas{
    background:white; border-radius:8px; box-shadow:0 6px 22px rgba(0,0,0,0.06);
    max-width: calc(100% - 40px); max-height: calc(100% - 40px); touch-action:none;
    display:block;
  }
  #placeholder{
    position:absolute; z-index:10; pointer-events:none; text-align:center; color:#888; font-size:16px;
    padding:8px 14px; background:rgba(255,255,255,0.85); border-radius:8px;
  }

  label.btn input[type=file]{ display:none; }
</style>
</head>
<body>
  <div class="app">
    <header>
      <!-- Silhouette dropdown -->
      <div class="dropdown" id="sil-dd">
        <button class="btn" onclick="toggleDropdown(event,'sil-dd')">Silhouette ▾</button>
        <div class="dropdown-content">
          <button class="item" onclick="setSilhouette('silhouette/woman.png'); closeDropdowns()">Femme</button>
          <button class="item" onclick="setSilhouette('silhouette/man.png'); closeDropdowns()">Homme</button>
          <button class="item" onclick="setSilhouette('silhouette/child.png'); closeDropdowns()">Enfant</button>
          <button class="item" onclick="setSilhouette('silhouette/baby.png'); closeDropdowns()">Bébé</button>
          <label class="item" for="uploadSil">Ajouter une image</label>
          <input id="uploadSil" type="file" accept="image/*" style="display:none" onchange="uploadSilhouette(event)">
          <button class="item" onclick="removeSilhouette(); closeDropdowns()">Supprimer silhouette</button>
        </div>
      </div>

      <!-- Dessin -->
      <div class="dropdown" id="draw-dd">
        <button class="btn" onclick="toggleDropdown(event,'draw-dd')">Dessin ▾</button>
        <div class="dropdown-content">
          <div class="tool-item">
            <label>Couleur</label>
            <input id="colorPicker" type="color" value="#000000">
          </div>
          <div class="tool-item">
            <label>Largeur</label>
            <input id="sizeRange" type="range" min="1" max="40" value="2">
            <span id="sizeLabel">2px</span>
          </div>
        </div>
      </div>

      <!-- Remplissage -->
      <div class="dropdown" id="fill-dd">
        <button class="btn" onclick="toggleDropdown(event,'fill-dd')">Remplissage ▾</button>
        <div class="dropdown-content">
          <div class="tool-item">
            <label>Couleur</label>
            <input id="fillColorPicker" type="color" value="#ff0000">
          </div>
          <div class="tool-item">
            <label for="patternFile">Motif</label>
            <input id="patternFile" type="file" accept="image/*" onchange="onPatternUpload(event)">
          </div>
          <div class="tool-item">
            <label>Taille motif</label>
            <select id="patternSizeSelect">
              <option value="25">25px</option>
              <option value="50" selected>50px</option>
              <option value="100">100px</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Mode buttons -->
      <button class="btn" id="btnDrawMode" onclick="enableDrawMode()">
        <img src="icons/crayon.svg"> Mode dessin
      </button>
      <button class="btn" id="btnFillMode" onclick="enableFillMode()">
        <img src="icons/spray.svg"> Mode remplissage
      </button>
    </header>

    <div class="canvas-wrap">
      <canvas id="board"></canvas>
      <div id="placeholder">✏️ Ici je laisse place à mon imagination — choisis une silhouette ou commence à dessiner</div>
    </div>

    <footer>
      <button class="btn" onclick="undo()"><img src="icons/undo.svg">Annuler</button>
      <button class="btn" onclick="redo()"><img src="icons/redo.svg">Rétablir</button>
      <button class="btn" onclick="clearBoard()"><img src="icons/clear.svg">Effacer</button>
      <button class="btn" onclick="downloadPNG()"><img src="icons/download.svg">Télécharger</button>
    </footer>
  </div>

<script>
const canvas = document.getElementById('board');
const ctx = canvas.getContext('2d');
const placeholder = document.getElementById('placeholder');
let dpr = Math.max(1, window.devicePixelRatio || 1);

let mode = 'draw';
let currentColor = '#000000';
let currentSize = 2;
let currentFill = '#ff0000';
let patternCanvas = null;
let patternW = 0, patternH = 0;
let silhouette = null;
let hasDrawn = false;

function resizeCanvas(){
  const cssW = 600, cssH = 500;
  canvas.style.width = cssW+'px';
  canvas.style.height = cssH+'px';
  canvas.width = cssW * dpr;
  canvas.height = cssH * dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
  redraw();
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function toggleDropdown(e,id){
  e.stopPropagation();
  document.querySelectorAll('.dropdown').forEach(dd=>dd.classList.remove('show'));
  document.getElementById(id).classList.toggle('show');
}
document.addEventListener('click', (ev)=> { if(!ev.target.closest('.dropdown')) closeDropdowns(); });
function closeDropdowns(){ document.querySelectorAll('.dropdown').forEach(dd=>dd.classList.remove('show')); }

function updatePlaceholder(){ placeholder.style.display = (hasDrawn || silhouette) ? 'none' : 'block'; }

function setSilhouette(src){
  const img = new Image();
  img.onload = ()=>{ silhouette = img; redraw(); updatePlaceholder(); };
  img.src = src;
}
function uploadSilhouette(e){
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader();
  r.onload = (ev)=>{ const img=new Image(); img.onload=()=>{ silhouette=img; redraw(); updatePlaceholder(); }; img.src=ev.target.result; };
  r.readAsDataURL(f);
}
function removeSilhouette(){ silhouette=null; redraw(); updatePlaceholder(); }

function redraw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(silhouette){
    const cssW = canvas.clientWidth, cssH = canvas.clientHeight;
    const ratio = Math.min(cssW/silhouette.width, cssH/silhouette.height)*0.9;
    const w = silhouette.width*ratio, h = silhouette.height*ratio;
    ctx.drawImage(silhouette,(cssW-w)/2,(cssH-h)/2,w,h);
  }
}

function enableDrawMode(){ mode='draw'; canvas.style.cursor='crosshair'; }
function enableFillMode(){ mode='fill'; canvas.style.cursor='cell'; }

document.getElementById('colorPicker').oninput = e=>currentColor=e.target.value;
document.getElementById('sizeRange').oninput = e=>{ currentSize=+e.target.value; document.getElementById('sizeLabel').textContent=currentSize+'px'; };
document.getElementById('fillColorPicker').oninput = e=>{ currentFill=e.target.value; patternCanvas=null; };

document.getElementById('patternFile').onchange = onPatternUpload;
function onPatternUpload(e){
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=ev=>{
    const img=new Image();
    img.onload=()=>{
      const size=+document.getElementById('patternSizeSelect').value;
      patternW=size*dpr; patternH=size*dpr;
      const pc=document.createElement('canvas'); pc.width=patternW; pc.height=patternH;
      pc.getContext('2d').drawImage(img,0,0,patternW,patternH);
      patternCanvas=pc;
    };
    img.src=ev.target.result;
  };
  r.readAsDataURL(f);
}

function clearBoard(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  redraw(); // redraw silhouette if any
  hasDrawn=false; updatePlaceholder();
}

function downloadPNG(){
  const a=document.createElement('a');
  a.href=canvas.toDataURL('image/png');
  a.download='croquis.png';
  a.click();
}

// TODO: undo/redo same as avant mais raccourci pour place
function undo(){}
function redo(){}
</script>
</body>
</html>
