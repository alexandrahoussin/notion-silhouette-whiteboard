<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Whiteboard Couture ‚Äî Zoom/Pan corrig√©</title>
<style>
  :root {
    --btn: #E0EBDB;
    --btn-hover: #FE6FA8;
    --panel: #ffffff;
    --text: #333;
    --dropdown-w: 280px;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:#fafafa;color:var(--text);}
  .app{display:flex;flex-direction:column;height:100vh;gap:8px;padding:8px;box-sizing:border-box;}

  header, footer{
    display:flex;align-items:center;justify-content:center;gap:10px;
    background:var(--panel);padding:10px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.06);
    flex-wrap:wrap;
  }

  .btn, label.btn {
    background:var(--btn); border:0; padding:8px 12px; border-radius:8px;
    min-width:120px; height:40px; display:inline-flex; align-items:center; justify-content:center;
    gap:8px; cursor:pointer; font-size:14px; color:#444;
  }
  .btn img{ width:18px; height:18px; }
  .btn:hover{ background:var(--btn-hover); color:white; }

  .canvas-wrap{ flex:1; display:flex; align-items:center; justify-content:center; position:relative; }
  canvas{
    background:white; border-radius:8px; box-shadow:0 6px 22px rgba(0,0,0,0.06);
    max-width: calc(100% - 40px); max-height: calc(100% - 40px); touch-action:none;
    display:block;
  }
  #placeholder{
    position:absolute; z-index:10; pointer-events:none; text-align:center; color:#888; font-size:16px;
    padding:8px 14px; background:rgba(255,255,255,0.85); border-radius:8px;
  }
</style>
</head>
<body>
  <div class="app">
    <header>
      <button class="btn" onclick="enableDrawMode()">‚úèÔ∏è Mode dessin</button>
      <button class="btn" onclick="enableFillMode()">ü™£ Mode remplissage</button>
      <button class="btn" onclick="zoomIn()">üîç +</button>
      <button class="btn" onclick="zoomOut()">üîç -</button>
      <button class="btn" onclick="resetView()">üîÑ R√©initialiser vue</button>
    </header>

    <div class="canvas-wrap">
      <canvas id="board"></canvas>
      <div id="placeholder">‚úèÔ∏è Ici je laisse place √† mon imagination ‚Äî choisis une silhouette ou commence √† dessiner</div>
    </div>

    <footer>
      <button class="btn" onclick="undo()">‚Ü©Ô∏è Annuler</button>
      <button class="btn" onclick="redo()">‚Ü™Ô∏è R√©tablir</button>
      <button class="btn" onclick="clearBoard()">üßπ Effacer</button>
      <button class="btn" onclick="downloadPNG()">‚¨áÔ∏è T√©l√©charger</button>
    </footer>
  </div>

<script>
const canvas = document.getElementById('board');
const ctx = canvas.getContext('2d');
const placeholder = document.getElementById('placeholder');
let dpr = Math.max(1, window.devicePixelRatio || 1);

let mode = 'draw'; 
let currentColor = '#000000';
let currentSize = 2;
let hasDrawn = false;

/* Undo/redo */
let undoStack = [], redoStack = [];
function pushState(){
  try{ undoStack.push(ctx.getImageData(0,0,canvas.width,canvas.height)); redoStack=[]; }
  catch(e){}
}
function undo(){
  if(!undoStack.length) return;
  let last = undoStack.pop();
  redoStack.push(ctx.getImageData(0,0,canvas.width,canvas.height));
  ctx.putImageData(last,0,0);
}
function redo(){
  if(!redoStack.length) return;
  let next = redoStack.pop();
  undoStack.push(ctx.getImageData(0,0,canvas.width,canvas.height));
  ctx.putImageData(next,0,0);
}

/* Zoom / Pan state */
let zoomLevel = 1;
let panX = 0, panY = 0;
let isPanning = false;
let startPan = {x:0,y:0};

function applyTransform(){
  ctx.setTransform(dpr,0,0,dpr,0,0); // reset
  ctx.scale(zoomLevel, zoomLevel);
  ctx.translate(panX, panY);
  redraw();
}
function zoomIn(){ zoomLevel *= 1.2; applyTransform(); }
function zoomOut(){ zoomLevel /= 1.2; applyTransform(); }
function resetView(){ zoomLevel=1; panX=0; panY=0; applyTransform(); }

/* Resize */
function resizeCanvas(){
  const cssW = Math.min(720, window.innerWidth-40);
  const cssH = Math.min(720, window.innerHeight-200);
  canvas.style.width = cssW+"px";
  canvas.style.height = cssH+"px";
  canvas.width = cssW * dpr;
  canvas.height = cssH * dpr;
  applyTransform();
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

/* Drawing */
let drawing = false;
function getCanvasPos(evt){
  const rect = canvas.getBoundingClientRect();
  const x = (evt.clientX-rect.left)/rect.width*canvas.width/dpr;
  const y = (evt.clientY-rect.top)/rect.height*canvas.height/dpr;
  return {x:(x/zoomLevel - panX), y:(y/zoomLevel - panY)};
}

canvas.addEventListener('pointerdown', (e)=>{
  if(e.button===1 || e.button===2 || e.shiftKey){ // pan avec clic droit ou shift
    isPanning=true;
    startPan={x:e.clientX,y:e.clientY};
    return;
  }
  drawing=true;
  pushState();
  const pos=getCanvasPos(e);
  ctx.beginPath();
  ctx.lineCap="round"; ctx.lineJoin="round";
  ctx.strokeStyle=currentColor; ctx.lineWidth=currentSize;
  ctx.moveTo(pos.x,pos.y);
});
canvas.addEventListener('pointermove', (e)=>{
  if(isPanning){
    panX += (e.clientX-startPan.x)/(50*zoomLevel);
    panY += (e.clientY-startPan.y)/(50*zoomLevel);
    startPan={x:e.clientX,y:e.clientY};
    applyTransform();
    return;
  }
  if(!drawing) return;
  const pos=getCanvasPos(e);
  ctx.lineTo(pos.x,pos.y);
  ctx.stroke();
  hasDrawn=true; placeholder.style.display="none";
});
window.addEventListener('pointerup', ()=>{ drawing=false; isPanning=false; });

/* Modes */
function enableDrawMode(){ mode='draw'; canvas.style.cursor="crosshair"; }
function enableFillMode(){ mode='fill'; canvas.style.cursor="cell"; }

/* Clear/download */
function clearBoard(){ pushState(); ctx.clearRect(-panX, -panY, canvas.width, canvas.height); }
function downloadPNG(){
  const a=document.createElement("a");
  a.href=canvas.toDataURL("image/png");
  a.download="croquis.png"; a.click();
}

function redraw(){ /* Ici si tu veux redessiner silhouette */ }

pushState();
</script>
</body>
</html>
